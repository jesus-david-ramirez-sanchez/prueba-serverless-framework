FROM node:20-alpine

# Instalar dependencias del sistema
RUN apk add --no-cache \
    git \
    bash \
    curl \
    && rm -rf /var/cache/apk/*

# Crear directorio de trabajo
WORKDIR /app

# Copiar package.json y package-lock.json
COPY package*.json ./

# Instalar dependencias (incluyendo devDependencies para desarrollo)
RUN npm install

# Copiar código fuente
COPY . .

# Configurar permisos
RUN chown -R node:node /app
USER node

# Exponer puerto para la aplicación
EXPOSE 3000

# Variables de entorno para desarrollo local
ENV NODE_ENV=development
ENV STAGE=dev
ENV AWS_ACCESS_KEY_ID=local
ENV AWS_SECRET_ACCESS_KEY=local
ENV AWS_DEFAULT_REGION=us-east-1
ENV DYNAMODB_ENDPOINT=http://dynamodb-local:8000
ENV SERVERLESS_ACCESS_KEY=AK0LKMGbdg6aO9K68Gjg2KJ6EJNaS4Qt5TbqCSPj2aNvf

# Comando por defecto para desarrollo
CMD ["npm", "run", "dev"]
